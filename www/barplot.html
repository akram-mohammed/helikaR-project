<!DOCTYPE html>
<html>
<head>
	<title>Old faithful data</title>
</head>

<style>

	body {
		font: 10px monospace;
	}

	.bar rect {
		fill: #33aa33;
	}

	.bar text {
		fill: #fff;
	}

	.axis path {
		fill: none;
		stroke: #000;
	}

</style>
<body>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script>

	var shinyBinding = new Shiny.OutputBinding();

	shinyBinding.find = function(scope) {
		return $(scope).find(".shiny-output");
	};

	shinyBinding.renderValue = function(el, data) {

		var formatCount = d3.format(",.0f");

		width = 800,
		height = 300;

		var x = d3.scale.linear()
		.domain([0, 100])
		.range([0, width]);

		var hist = d3.layout.histogram()
		.bins(x.ticks())
		(data);

		var y = d3.scale.linear()
		.domain([0, d3.max(hist, function(d) { return d.y; })])
		.range([height, 0]);

		var xAxis = d3.svg.axis()
		.scale(x)
		.orient("bottom");

		var yAxis = d3.svg.axis()
		.scale(y)
		.orient("left");

		var svg = d3.select("body").append("svg")
		.attr("width", width + 100)
		.attr("height", height + 50)	
		.append("g")
		.attr("transform", "translate(10, 10)");

		var bar = svg.selectAll(".bar")
		.data(hist)
		.enter().append("g")
		.attr("class", "bar")
		.attr("transform", function(d) { return "translate(" + (x(d.x) + 10) + "," + y(d.y) + ")"; });

		bar.append("rect")
		.attr("x", 1)
		.attr("width", x(hist[0].dx) - 1)
		.attr("height", function(d) { return height - y(d.y); });

		bar.append("text")
		.attr("dy", 10)
		.attr("x", x(hist[0].dx) / 2)
		.attr("text-anchor", "middle")
		.text(function(d) { return formatCount(d.y); });

		svg.append("g")
		.attr("class", "x axis")
		.attr("transform", "translate(10," + height + ")")
		.call(xAxis);
		
		svg.append("g")
		.attr("class", "y axis")
		.attr("transform", "translate(10, 0)")
		.call(yAxis);
	}

	Shiny.outputBindings.register(shinyBinding, "myBinding");

</script>
